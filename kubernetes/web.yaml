apiVersion: v1
kind: Pod
metadata:
  name: fitness-web
  labels:
    name: fitness-web
spec:
  containers:
  - name: web
    image: registry.noizwaves.cloud/fitness
    stdin: true
    tty: true
    args:
      - './bin/rails'
      - 'server'
      - '-b'
      - '0.0.0.0'
    env:
      - name: DB_HOST
        value: postgres
      - name: REDIS_URL
        value: redis://redis:6379/0
    volumeMounts:
      - name: fitness-packs
        mountPath: /app/public/packs
      - name: vscode
        mountPath: "/root/.config/code-server"
        subPath: "config"
      - name: vscode
        mountPath: "/root/.local/share/code-server"
        subPath: "local/share"
  - name: webpack
    image: registry.noizwaves.cloud/fitness
    stdin: true
    tty: true
    command:
      - './bin/webpack-dev-server'
    env:
      - name: DB_HOST
        value: postgres
      - name: REDIS_URL
        value: redis://redis:6379/0
    volumeMounts:
      - name: fitness-packs
        mountPath: /app/public/packs
  volumes:
    - name: fitness-packs
      emptyDir: {}
    - name: vscode
      persistentVolumeClaim:
        claimName: ide-vscode

---

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: ide-vscode
spec:
  resources:
    requests:
      storage: 10Gi
  accessModes:
    - ReadWriteOnce