apiVersion: v1
kind: Pod
metadata:
  name: fitness-web
  labels:
    name: fitness-web
spec:
  containers:
  - name: web
    image: registry.noizwaves.cloud/fitness
    stdin: true
    tty: true
    args:
      - './bin/rails'
      - 'server'
      - '-b'
      - '0.0.0.0'
    env:
      - name: DB_HOST
        value: postgres
      - name: REDIS_URL
        value: redis://redis:6379/0
    volumeMounts:
      - name: home
        mountPath: /app
        subPath: workspace/fitness
  - name: webpack
    image: registry.noizwaves.cloud/fitness
    stdin: true
    tty: true
    command:
      - './bin/webpack-dev-server'
    env:
      - name: DB_HOST
        value: postgres
      - name: REDIS_URL
        value: redis://redis:6379/0
    volumeMounts:
      - name: home
        mountPath: /app
        subPath: workspace/fitness
  volumes:
    - name: home
      persistentVolumeClaim:
        claimName: home
