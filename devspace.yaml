version: v1beta9
images:
  app:
    image: ghcr.io/noizwaves/fitness-dev
    createPullSecret: true
    preferSyncOverRebuild: true
    rebuildStrategy: ignoreContextChanges
    injectRestartHelper: true
    appendDockerfileInstructions:
    - USER root
    build:
      kaniko:
        cache: true
        pullSecret: devspace-auth-ghcr-io
deployments:
  - name: fitness-dependencies
    kubectl:
      replaceImageTags: false
      manifests:
        - kubernetes/postgres.yaml
        - kubernetes/redis.yaml
  - name: fitness
    kubectl:
      replaceImageTags: true
      manifests:
        - kubernetes/web.yaml
        - kubernetes/sidekiq.yaml
dev:
  sync:
  - labelSelector:
      name: fitness-web
    containerName: web
    excludePaths:
      - .git/
      - .gitignore
      - .devspace
    uploadExcludePaths:
      - node_modules
      - kubernetes
      - log
      - '!log/.keep'
      - tmp
      - '!tmp/.keep'
      - Dockerfile
      - docker-compose.yml
      - .tool-versions
      - .idea
      - devspace.yaml
      - public/packs
    downloadExcludePaths:
      - tmp
      - node_modules
      - log
      - public/packs
    onUpload:
      restartContainer: false
  - labelSelector:
      name: fitness-web
    containerName: webpack
    excludePaths:
      - .git/
      - .gitignore
      - .devspace
    uploadExcludePaths:
      - node_modules
      - kubernetes
      - log
      - '!log/.keep'
      - tmp
      - '!tmp/.keep'
      - Dockerfile
      - docker-compose.yml
      - .tool-versions
      - .idea
      - devspace.yaml
      - public/packs
    downloadExcludePaths:
      - tmp
      - node_modules
      - log
      - public/packs
    onUpload:
      restartContainer: false
  ports:
    - labelSelector:
        name: fitness-web
      forward:
        - port: 3000
          remotePort: 3000
    - labelSelector:
        name: fitness-web
      forward:
        - port: 3035
          remotePort: 3035
  logs:
    disabled: true
profiles:
- name: production
  description: ""
  patches:
  - op: remove
    path: images.app.appendDockerfileInstructions
  - op: remove
    path: images.app.injectRestartHelper
- name: interactive
  description: ""
  patches:
  - op: add
    path: dev.interactive
    value:
      defaultEnabled: true
  - op: add
    path: images.app.entrypoint
    value:
    - sleep
    - "9999999999"
